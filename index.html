<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OY Goethe</title>
    <link rel="stylesheet" href="mm.css">
</head>
<body>
  <div id="head">
    <img src="oy15.png" alt="oy15">
    <h1 id="OY">OY Goethe</h1>
  </div>
  <img src="allb1.png" alt="1">
  <img src="allb2.png" alt="2">
  <h1 style="margin: auto; width: 50%; color: rgb(22, 103, 46); text-align: center; position: relative; top: 5%;">صفحة تسجيل البيانات</h1>
  <div class="product-container">
    <form onsubmit="return false" class="product-form">
        <img src="oy14.png" style=" position:fixed; width: 90%; left: 4%; bottom: -15%; z-index: -1;"  alt="yo0">

        <div style="display: flex;">
          <h3 id="erro">تنبيه:</h3><h3>يرجى إدخال البيانات كما هو مكتوب في جواز السفر حصرا</h3>
        </div>

        <hr style="width: 100%; height: 2px; background-color: rgb(0, 0, 0); border: none;margin: 5px;">
        <label for="name">الاسم</label>
        <input type="text" id="first" placeholder=" كما هو مكتوب في جواز السفر" name="name">
        <br>
        <label for="price">الكنية</label>
        <input type="text" id="last" placeholder=" كما هو مكتوب في جواز السفر" name="price">
        <br>
        <label for="date_from">تاريخ الولادة (كما هو مكتوب في جواز السفر)</label>
        <div id="date_from">
        <select id="day" class="form-control" tabindex="3" data-dkcacheid="1">
          <option value="" disabled selected>اليوم</option>
          
              <option value="1">1</option>
          
              <option value="2">2</option>
          
              <option value="3">3</option>
          
              <option value="4">4</option>
          
              <option value="5">5</option>
          
              <option value="6">6</option>
          
              <option value="7">7</option>
          
              <option value="8">8</option>
          
              <option value="9">9</option>
          
              <option value="10">10</option>
          
              <option value="11">11</option>
          
              <option value="12">12</option>
          
              <option value="13">13</option>
          
              <option value="14">14</option>
          
              <option value="15">15</option>
          
              <option value="16">16</option>
          
              <option value="17">17</option>
          
              <option value="18">18</option>
          
              <option value="19">19</option>
          
              <option value="20">20</option>
          
              <option value="21">21</option>
          
              <option value="22">22</option>
          
              <option value="23">23</option>
          
              <option value="24">24</option>
          
              <option value="25">25</option>
          
              <option value="26">26</option>
          
              <option value="27">27</option>
          
              <option value="28">28</option>
          
              <option value="29">29</option>
          
              <option value="30">30</option>
          
              <option value="31">31</option>
        </select>
        <select id="mounth" class="form-control" tabindex="3" data-dkcacheid="1">
          <option value="" disabled selected>الشهر</option>
          
              <option value="1">1</option>
          
              <option value="2">2</option>
          
              <option value="3">3</option>
          
              <option value="4">4</option>
          
              <option value="5">5</option>
          
              <option value="6">6</option>
          
              <option value="7">7</option>
          
              <option value="8">8</option>
          
              <option value="9">9</option>
          
              <option value="10">10</option>
          
              <option value="11">11</option>
          
              <option value="12">12</option>
        </select>
        <select id="year" class="form-control" tabindex="3" data-dkcacheid="1">
          <option value="" disabled selected>العام</option>
          
              <option value="1970">1970</option>
          
              <option value="1971">1971</option>
          
              <option value="1972">1972</option>
          
              <option value="1973">1973</option>
          
              <option value="1974">1974</option>
          
              <option value="1975">1975</option>
          
              <option value="1976">1976</option>
          
              <option value="1977">1977</option>
          
              <option value="1978">1978</option>
          
              <option value="1979">1979</option>
          
              <option value="1980">1980</option>
          
              <option value="1981">1981</option>
          
              <option value="1982">1982</option>
          
              <option value="1983">1983</option>
          
              <option value="1984">1984</option>
          
              <option value="1985">1985</option>
          
              <option value="1986">1986</option>
          
              <option value="1987">1987</option>
          
              <option value="1988">1988</option>
          
              <option value="1989">1989</option>
          
              <option value="1990">1990</option>
          
              <option value="1991">1991</option>
          
              <option value="1992">1992</option>
          
              <option value="1993">1993</option>
          
              <option value="1994">1994</option>
          
              <option value="1995">1995</option>
          
              <option value="1996">1996</option>
          
              <option value="1997">1997</option>
          
              <option value="1998">1998</option>
          
              <option value="1999">1999</option>
          
              <option value="2000">2000</option>

              <option value="2001">2001</option>
          
              <option value="2002">2002</option>
          
              <option value="2003">2003</option>
          
              <option value="2004">2004</option>
          
              <option value="2005">2005</option>
          
              <option value="2006">2006</option>
          
              <option value="2007">2007</option>
          
              <option value="2008">2008</option>
          
              <option value="2009">2009</option>
          
              <option value="2010">2010</option>
          
              <option value="2011">2011</option>
          
              <option value="2012">2012</option>
          
              <option value="2013">2013</option>
          
              <option value="2014">2014</option>
          
              <option value="2015">2015</option>
          
              <option value="2016">2016</option>
          
              <option value="2017">2017</option>
          
              <option value="2018">2018</option>
          
              <option value="2019">2019</option>
          
              <option value="2020">2020</option>
          
              <option value="2021">2021</option>
          
              <option value="2022">2022</option>
        </select>
        </div>
        <br>
        <label for="date_from">مكان الولادة</label>
        <input type="text" id="country" placeholder=" كما هو مكتوب في جواز السفر" name="date_from">
        <br>
        <label for="image">رقم الهاتف</label>
        <input type="tel" id="Phone" value="+963">
        <br>
        <label for="image">الايميل</label>
        <input type="text" id="e-mail">
        <br>
        <label for="image">مكان السكن</label>
        <input type="text" id="street_name">
        <br>
        <label for="image">مستوى الامتحان</label>
        <select id="level" class="form-control" tabindex="3" data-dkcacheid="1">
          <option value="" disabled selected>المستوى</option>
          
              <option value="A1">A1</option>
          
              <option value="A2">A2</option>
          
              <option value="B1">B1</option>
          
              <option value="B2">B2</option>
          
              <option value="C1">C1</option>
          
              <option value="C2">C2</option>
        </select>
        <br>
        <div class="show_date" style="display: none;">

          <label for="image">تاريخ الامتحان المطلوب</label>
          <div id="len_gothe">
          <h5>ملاحظة: يرجى زيارة الرابط والاطلاع على مواعيد الامتحان واختيار الموعد المناسب>></h5>
          <a id="len_go" target="_blank">مواعيد امتحان A1>></a>
          </div>
          <div id="date_from">
          <select id="level_day" class="form-control" tabindex="3" data-dkcacheid="1">
            <option value="" disabled selected>اليوم</option>
            
                <option value="1">1</option>
            
                <option value="2">2</option>
            
                <option value="3">3</option>
            
                <option value="4">4</option>
            
                <option value="5">5</option>
            
                <option value="6">6</option>
            
                <option value="7">7</option>
            
                <option value="8">8</option>
            
                <option value="9">9</option>
            
                <option value="10">10</option>
            
                <option value="11">11</option>
            
                <option value="12">12</option>
            
                <option value="13">13</option>
            
                <option value="14">14</option>
            
                <option value="15">15</option>
            
                <option value="16">16</option>
            
                <option value="17">17</option>
            
                <option value="18">18</option>
            
                <option value="19">19</option>
            
                <option value="20">20</option>
            
                <option value="21">21</option>
            
                <option value="22">22</option>
            
                <option value="23">23</option>
            
                <option value="24">24</option>
            
                <option value="25">25</option>
            
                <option value="26">26</option>
            
                <option value="27">27</option>
            
                <option value="28">28</option>
            
                <option value="29">29</option>
            
                <option value="30">30</option>
            
                <option value="31">31</option>
          </select>
          <select id="level_mounth" class="form-control" tabindex="3" data-dkcacheid="1">
            <option value="" disabled selected>الشهر</option>
            
                <option value="1">1</option>
            
                <option value="2">2</option>
            
                <option value="3">3</option>
            
                <option value="4">4</option>
            
                <option value="5">5</option>
            
                <option value="6">6</option>
            
                <option value="7">7</option>
            
                <option value="8">8</option>
            
                <option value="9">9</option>
            
                <option value="10">10</option>
            
                <option value="11">11</option>
            
                <option value="12">12</option>
          </select>
          <select id="level_year" class="form-control" tabindex="3" data-dkcacheid="1">
          <option value="" disabled selected>العام</option>
          <option value="2023">2023</option>
          <option value="2024">2024</option>
          </select>
          </div>
        </div>
        <br>
        <div id="AMPA" style="display: none; flex-direction: column; ">
        <label for="image">تصنيف الموعد</label>
        <select id="id_ampa" class="form-control" tabindex="3" data-dkcacheid="1">
          <option value="" disabled selected>صباحي/مسائي</option>
          <option value="AM">صباحي</option>
          <option value="PM">مسائي</option>
        </select>
        </div>
        <br>
        <div id="yes_no">
        <label for="image">هل تقدمت سابقا لأي امتحان مهما كان المستوى سابقا في معهد غوتة في اي دولة سابقا</label>
        <select id="yesno" class="form-control" tabindex="3" data-dkcacheid="1">
        <option value="" disabled selected>اجب نعم او لا</option>
        <option value="Yes">نعم</option>
        <option value="No">لا</option>
        </select>
        </div>
        <br>
        <h4 id="mas_error" style="text-align: center; color: rgb(255, 0, 0); background-color: rgba(165, 42, 42, 0.325); height: 25px; display: none;">يرجى تعبئة الفراغات بالكامل</h4>
        <input type="submit" id="submit" value="Submit">
    </form>
  </div>
  <script type="module">
    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
    import { getDatabase, update, get, set, ref, onChildAdded, onChildChanged, push, child} from "https://www.gstatic.com/firebasejs/9.20.0/firebase-database.js";
    const Config = {
      apiKey: "AIzaSyBhPBlerMZGPPn9mfYsZYuIBH0sjAcDoBY",
      authDomain: "oy-goethe.firebaseapp.com",
      databaseURL: "https://oy-goethe-default-rtdb.firebaseio.com",
      projectId: "oy-goethe",
      storageBucket: "oy-goethe.appspot.com",
      messagingSenderId: "1080444425010",
      appId: "1:1080444425010:web:8a7fe567e8d82363cb7d2b"
    };
    const app = initializeApp(Config);
    const db = getDatabase(app);
    const dbRef = ref(db, '/user/')

    let maxnum;
    let isopen
    onChildChanged(ref(db,'resmax'),(nummax) => {
      maxnum = nummax.val()
    })

    onChildAdded(ref(db,'resmax'),(resed)=> {
      maxnum = resed.val()
    })

    onChildChanged(ref(db,'bool'),(resed)=>{
      isopen = resed.val()
    })
    onChildAdded(ref(db,'bool'),(resed)=>{
      isopen = resed.val()
    })

    let firname = document.getElementById('first')
    let lastname = document.getElementById('last')
    let contrdate1 = document.getElementById('day')
    let contrdate2 = document.getElementById('mounth')
    let contrdate3 = document.getElementById('year')
    let contry = document.getElementById('country')
    let submit = document.getElementById('submit')
    let phone = document.getElementById('Phone')
    let email = document.getElementById('e-mail')
    let street = document.getElementById('street_name')
    let level = document.getElementById('level')
    let linkgo = document.getElementById('len_go')
    let showdate = document.querySelector('.show_date')
    let ampa = document.querySelector('#AMPA')
    let levelday = document.getElementById('level_day')
    let levelmounth = document.getElementById('level_mounth')
    let levelyear = document.getElementById('level_year')
    let idampa = document.getElementById('id_ampa')
    let yesno = document.getElementById('yesno')
    let date1 = new Date();
    let dateevry;
    
    let arrinpall = [firname,lastname,contrdate1,contrdate2,contrdate3,contry,phone,email,street,level,levelday,levelmounth,levelyear,yesno];
    
    submit.onclick = () =>{
      let isfull;
      for(let i = 0; i < arrinpall.length; i++){
        if(arrinpall[i].value == ''){
          arrinpall[i].classList.add('inperror')
          isfull = false
          document.querySelector('#mas_error').style.display = 'block'
        }
        else{arrinpall[i].classList.add('inptrue')}
      }
      if(isfull !== false){
        setdata()
      }

    }

    
    
  function setdata(){
    if(isopen == false || maxnum == 0){
      location.replace('https://zain00abd.github.io/Accesserror/')
    }
    else{
      dateevry = date1.getDate() + '/' + (date1.getMonth() +1) + '/' + date1.getFullYear();
      let arrdata = []
      let data = {
        dateN:dateevry,
        Firstname:firname.value,
        Lastname:lastname.value,
        Email:email.value,
        Phone:phone.value,
        Contry:contry.value,
        Street:street.value,
        Level:level.value,
        Idampa:idampa.value,
        Yesno:yesno.value,
        Datemelad:contrdate1.value + '.' + contrdate2.value + '.' + contrdate3.value,
        Dateexam:levelday.value + '.' + levelmounth.value + '.' + levelyear.value,
      }
      arrdata.push(data)
        
      push(dbRef,arrdata[0]).then((res)=>{
        if(maxnum !== undefined){
          update(ref(db,'resmax/'),{
            'num':maxnum - 1,
          })
        }
        location.replace('https://zain00abd.github.io/OY-Goethe-Truesubmit/')
      })  
    }
  }
        
  let isrelode
  level.addEventListener('click',() =>{
    isrelode = true
    console.log('1')
  })

  setInterval(function(){
    if(isrelode){
    selectlevel()
    }
  },300)
    
  function selectlevel(){
    if(level.value == 'A1'){
      linkgo.setAttribute('href','https://www.goethe.de/ins/lb/ar/spr/prf/gzsd1.cfm')
      ampa.style.display = 'flex'
    }

    else if(level.value == 'A2'){
      linkgo.setAttribute('href','https://www.goethe.de/ins/lb/ar/spr/prf/gzsd2.cfm')
      ampa.style.display = 'none'
    }

    else if(level.value == 'B1'){
      linkgo.setAttribute('href','https://www.goethe.de/ins/lb/ar/spr/prf/gzb1.cfm')
      ampa.style.display = 'none'
    }
    
    else if(level.value == 'B2'){
      linkgo.setAttribute('href','https://www.goethe.de/ins/lb/ar/spr/prf/gzb2.cfm')
      ampa.style.display = 'none'
    }
    
    else if(level.value == 'C1'){
      linkgo.setAttribute('href','https://www.goethe.de/ins/lb/ar/spr/prf/gzc1.cfm')
      ampa.style.display = 'none'
    }
      
    else if(level.value == 'C2'){
      linkgo.setAttribute('href','https://www.goethe.de/ins/lb/ar/spr/prf/gzc2.cfm')
      ampa.style.display = 'none'
    }
      linkgo.innerHTML = `مواعيد امتحان ${level.value}>>`
      showdate.style.display = 'block'
    }


  </script>
</body>
</html>